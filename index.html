<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Image Viewer</title>
</head>
<body>

    <h2>Image Viewer</h2>
    
    <!-- Dropdowns -->
    <label for="excelDropdown">Excel File:</label>
    <select id="excelDropdown">
        <option>Loading...</option>
    </select>

    <label for="sheetDropdown">Sheet:</label>
    <select id="sheetDropdown" disabled>
        <option>Select Excel File First</option>
    </select>

    <label for="imageDropdown">Image:</label>
    <select id="imageDropdown" disabled>
        <option>Select Sheet First</option>
    </select>

    <!-- Image Display -->
    <div>
        <img id="imageDisplay" src="" alt="Selected Image" style="max-width: 100%; display: none;">
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const repoURL = "https://api.github.com/repos/DRTALEXANDER/image-viewer/contents/images"; // Update with your repo
            const excelDropdown = document.getElementById("excelDropdown");
            const sheetDropdown = document.getElementById("sheetDropdown");
            const imageDropdown = document.getElementById("imageDropdown");
            const imageDisplay = document.getElementById("imageDisplay");

            fetch(repoURL)
                .then(response => response.json())
                .then(data => {
                    let fileNames = data
                        .filter(file => file.name.match(/\.(jpg|jpeg|png|gif)$/i))
                        .map(file => file.name);

                    if (fileNames.length === 0) {
                        excelDropdown.innerHTML = "<option>No Images Found</option>";
                        return;
                    }

                    let groupedFiles = {};

                    fileNames.forEach(file => {
                        const parts = file.split("-");
                        if (parts.length < 4) return;

                        let excelName = parts[0];
                        let sheetName = parts[1];
                        let number = parseInt(parts[2], 10);
                        let imageName = parts.slice(3).join("-");

                        if (!groupedFiles[excelName]) groupedFiles[excelName] = {};
                        if (!groupedFiles[excelName][sheetName]) groupedFiles[excelName][sheetName] = [];

                        groupedFiles[excelName][sheetName].push({ number, imageName, fullPath: file });
                    });

                    // Sort images by sequential number
                    Object.keys(groupedFiles).forEach(excel => {
                        Object.keys(groupedFiles[excel]).forEach(sheet => {
                            groupedFiles[excel][sheet].sort((a, b) => a.number - b.number);
                        });
                    });

                    // Populate Excel dropdown
                    excelDropdown.innerHTML = '<option>Select a file</option>';
                    Object.keys(groupedFiles).forEach(excel => {
                        let option = document.createElement("option");
                        option.value = excel;
                        option.textContent = excel;
                        excelDropdown.appendChild(option);
                    });

                    // Event listener for Excel selection
                    excelDropdown.addEventListener("change", function () {
                        sheetDropdown.innerHTML = '<option>Select a sheet</option>';
                        imageDropdown.innerHTML = '<option>Select Image</option>';
                        imageDropdown.disabled = true;

                        let selectedExcel = this.value;
                        if (!groupedFiles[selectedExcel]) return;

                        Object.keys(groupedFiles[selectedExcel]).forEach(sheet => {
                            let option = document.createElement("option");
                            option.value = sheet;
                            option.textContent = sheet;
                            sheetDropdown.appendChild(option);
                        });

                        sheetDropdown.disabled = false;
                    });

                    // Event listener for Sheet selection
                    sheetDropdown.addEventListener("change", function () {
                        imageDropdown.innerHTML = '<option>Select Image</option>';
                        let selectedExcel = excelDropdown.value;
                        let selectedSheet = this.value;
                        if (!groupedFiles[selectedExcel][selectedSheet]) return;

                        groupedFiles[selectedExcel][selectedSheet].forEach(img => {
                            let option = document.createElement("option");
                            option.value = img.fullPath;
                            option.textContent = img.imageName;
                            imageDropdown.appendChild(option);
                        });

                        imageDropdown.disabled = false;
                    });

                    // Event listener for Image selection
                    imageDropdown.addEventListener("change", function () {
                        let selectedImage = this.value;
                        if (!selectedImage) return;

                        let imageURL = `https://raw.githubusercontent.com/DRTALEXANDER/image-viewer/main/images/${selectedImage}`;
                        imageDisplay.src = imageURL;
                        imageDisplay.style.display = "block";
                    });

                })
                .catch(error => console.error("Error fetching images:", error));
        });
    </script>

</body>
</html>
