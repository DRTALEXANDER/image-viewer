<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Viewer</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        select, button { margin: 10px; padding: 5px; }
        img { max-width: 80%; height: auto; margin-top: 20px; border: 1px solid #ccc; padding: 10px; }
    </style>
</head>
<body>

    <h2>Image Viewer</h2>
    
    <label for="fileSelect">Excel File:</label>
    <select id="fileSelect"><option>Loading...</option></select>

    <label for="sheetSelect">Sheet:</label>
    <select id="sheetSelect"><option>Select an Excel file first</option></select>

    <label for="imageSelect">Image:</label>
    <select id="imageSelect"><option>Select a sheet first</option></select>

    <br>
    <img id="displayImage" src="" alt="Selected Image">

    <script>
        const repoURL = "https://api.github.com/repos/DRTALEXANDER/image-viewer/contents/";

        async function fetchImages() {
            try {
                const response = await fetch(repoURL);
                const files = await response.json();
                
                // Filter only image files
                const imageFiles = files.filter(file => file.name.match(/\.(jpg|jpeg|png|gif)$/i));
                
                if (imageFiles.length === 0) {
                    document.getElementById("fileSelect").innerHTML = "<option>No images found</option>";
                    return;
                }

                // Extract unique Excel file names from the image file names
                const excelFiles = [...new Set(imageFiles.map(file => file.name.split('-')[0]))];

                let fileSelect = document.getElementById("fileSelect");
                fileSelect.innerHTML = "<option>Select a file</option>";

                excelFiles.forEach(file => {
                    let option = document.createElement("option");
                    option.value = file;
                    option.textContent = file;
                    fileSelect.appendChild(option);
                });

                // Event listener for Excel file selection
                fileSelect.addEventListener("change", function() {
                    const selectedFile = this.value;
                    const sheets = [...new Set(imageFiles
                        .filter(file => file.name.startsWith(selectedFile + "-"))
                        .map(file => file.name.split('-')[1]))];

                    let sheetSelect = document.getElementById("sheetSelect");
                    sheetSelect.innerHTML = "<option>Select a sheet</option>";

                    sheets.forEach(sheet => {
                        let option = document.createElement("option");
                        option.value = sheet;
                        option.textContent = sheet;
                        sheetSelect.appendChild(option);
                    });

                    // Reset image selection
                    document.getElementById("imageSelect").innerHTML = "<option>Select a sheet first</option>";
                    document.getElementById("displayImage").src = "";
                });

                // Event listener for sheet selection
                document.getElementById("sheetSelect").addEventListener("change", function() {
                    const selectedFile = document.getElementById("fileSelect").value;
                    const selectedSheet = this.value;
                    
                    const images = imageFiles
                        .filter(file => file.name.startsWith(selectedFile + "-" + selectedSheet + "-"))
                        .sort((a, b) => {
                            let numA = parseInt(a.name.split('-')[2]);
                            let numB = parseInt(b.name.split('-')[2]);
                            return numA - numB;
                        });

                    let imageSelect = document.getElementById("imageSelect");
                    imageSelect.innerHTML = "<option>Select an image</option>";

                    images.forEach(image => {
                        let option = document.createElement("option");
                        option.value = image.download_url;
                        option.textContent = image.name.split('-')[3];
                        imageSelect.appendChild(option);
                    });

                    // Reset displayed image
                    document.getElementById("displayImage").src = "";
                });

                // Event listener for image selection
                document.getElementById("imageSelect").addEventListener("change", function() {
                    document.getElementById("displayImage").src = this.value;
                });

            } catch (error) {
                console.error("Error fetching images:", error);
            }
        }

        fetchImages();
    </script>

</body>
</html>
